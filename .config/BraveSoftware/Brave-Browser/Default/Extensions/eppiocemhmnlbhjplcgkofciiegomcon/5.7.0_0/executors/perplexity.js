(()=>{const x=(()=>{const x=sessionStorage.getItem("bis_data");if(null!==x){return JSON.parse(x)}return null})(),$=x?.config?`${x.id}_t`:null,v=x?.config?.aiMessagesConfig?.PERPLEXITY||{},{PARSERS:C=[],CHATBOT_NAME:D=""}=v;ParserProcessors={XMLHttpRequest:function(x){const $=fetch;fetch=async function(v,C={}){let D=v instanceof Request?v.url:v;if("object"==typeof D&&D.href&&(D=D.href),!(x=>{let $=x.replace(/.*\/([gimy]*)$/,"$1"),v=x.replace(new RegExp("^/(.*?)/"+$+"$"),"$1");return new RegExp(v,$)})(x.QUERY).test(D))return $.apply(this,arguments);try{const v=await $.apply(this,arguments);return v.body instanceof ReadableStream&&setTimeout(V.bind(this,C,x,v.clone()),0),v}catch(x){return $.apply(this,arguments)}}}};const V=async(x,$,v)=>{const C=v.headers.get("Content-Type")||"";let D="",V="";try{C.includes("text/event-stream")&&(D=p(x.body,$.SEND_MESSAGE)||"",V=await K(v.body,$.RECEIVED_MESSAGE)||"")}catch(x){}finally{O(D,$.SEND_MESSAGE?.MESSAGE_LIMIT||1e4,"user"),O(V,$.RECEIVED_MESSAGE?.MESSAGE_LIMIT||3e4,"system")}},p=(x="{}",$={})=>{const{MESSAGE_QUERY:v=[],ATTACHMENTS_QUERY:C=[],SOURCE_QUERY:D=[],IGNORED_SOURCES:V=[]}=$;if(x){const $=JSON.parse(x),p=Z(D,$)||"";if(V.includes(p))return"";let K=Z(v,$)||"";if(K){const x=Z(C,$)||[];x?.length&&x.forEach((x=>{x.includes(K)&&(K="")}))}return K}return""},K=async(x,$={})=>{const{DATA_OBJ_QUERY:v=[],MESSAGE_QUERY:C=[]}=$,D=x.getReader(),V=new TextDecoder("utf-8");let p="";for(;;){const{value:x,done:$}=await D.read();if($)break;let K;for(p+=V.decode(x,{stream:!0}),p=p.replace(/\r\n/g,"\n");-1!==(K=p.indexOf("\n\n"));){const x=p.slice(0,K).trim();p=p.slice(K+2);const $=x.split("\n"),D={};for(const x of $){const[$,...v]=x.split(":");if($&&v.length){const x=v.join(":").trim();if("data"===$)try{D.data=JSON.parse(x)}catch{D.data=x}else D[$]=x}}const V=Z(v,D);if(V?.length){let x="";if(V.forEach(($=>{const v=Z(C,$);v&&(x=v)})),x)return x}}}},Z=(x,$)=>x.reduce(((x,$)=>x?"object"==typeof x?x[$]:x:null),$),O=(x,$,v)=>{const C=self.location.href.split("-"),D=C[C.length-1];if(x&&D){const C=U(x,$,D,v);C&&G(C)}},U=function(x,$,v,C="user"){return{chatbotName:D,messageType:C,sessionId:v,messageId:"",messageLength:x.length,messageText:x.trim().slice(0,$)}},G=x=>{try{let v={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"PERPLEXITY_DATA",from:$,to:$.substring(0,$.length-2),content:x};window.postMessage(v)}catch(x){}};for(let x of C)x.USE&&ParserProcessors[x.TYPE](x)})();