(()=>{const x=(()=>{const x=sessionStorage.getItem("bis_data");if(null!==x){return JSON.parse(x)}return null})(),$=x?.config?`${x.id}_t`:null,v=x?.config?.aiMessagesConfig?.CLAUDE||{},{PARSERS:C=[],CHATBOT_NAME:D=""}=v;ParserProcessors={XMLHttpRequest:function(x){const $=fetch,v=x=>{let $=x.replace(/.*\/([gimy]*)$/,"$1"),v=x.replace(new RegExp("^/(.*?)/"+$+"$"),"$1");return new RegExp(v,$)};fetch=async function(C,D={}){let K=C instanceof Request?C.url:C;"object"==typeof K&&K.href&&(K=K.href);const Z=v(x.QUERY).test(K),O=v(x.RETRY_QUERY).test(K);if(!Z&&!O)return $.apply(this,arguments);try{const v=await $.apply(this,arguments);if(v.body instanceof ReadableStream){const $=v.clone(),C=$.headers.get("Content-Type")||"",{body:Z}=D;Z&&C.includes("text/event-stream")&&(O||V(Z,K,x.SEND_MESSAGE),setTimeout(p.bind(this,$,K,x.RECEIVED_MESSAGE),0))}return v}catch(x){return $.apply(this,arguments)}}}};const V=(x,$,v)=>{const{MESSAGE_LIMIT:C=1e4,CONTENT_QUERY:D=[]}=v;if(!x)return"";try{const v=JSON.parse(x),V=K(D,v);V&&Z(V,C,$)}catch(x){}},p=async(x,$,v)=>{const{MESSAGE_LIMIT:C=[],LINE_START_QUERY:D="",CONTENT_TYPE:V,TEXT_PART_QUERY:p=[]}=v,O=x.body.getReader(),U=new TextDecoder("utf-8");let G="",w="";try{for(;;){const{done:x,value:$}=await O.read();if(x)break;G+=U.decode($,{stream:!0});const v=G.split("\n");G=v.pop();for(let x of v)if(x.startsWith(D))try{const $=JSON.parse(x.slice(D.length));$.type===V&&"string"==typeof K(p,$)&&(w+=K(p,$))}catch(x){}}Z(w,C,$,"system")}catch(x){}},K=(x,$)=>x.reduce(((x,$)=>x?"object"==typeof x?x[$]:x:null),$),Z=(x,$,v,C)=>{const D=v.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi),V=D?.[1];if(V&&x){const v=O(x,$,V,C);v&&U(v)}},O=function(x,$,v,C="user"){return{chatbotName:D,messageType:C,sessionId:v,messageId:"",messageLength:x.length,messageText:x.trim().slice(0,$)}},U=x=>{try{let v={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"CLAUDE_DATA",from:$,to:$.substring(0,$.length-2),content:x};window.postMessage(v)}catch(x){}};for(let x of C)x.USE&&ParserProcessors[x.TYPE](x)})();