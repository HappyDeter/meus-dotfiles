(()=>{function x(){function x(){return(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22)}const $=function(){let $=sessionStorage.getItem("bis_data");if(null!==$)return JSON.parse($);try{let $={posdMessageId:"PANELOS_MESSAGE",posdHash:x(),type:"CONFIG_NOT_FOUND",from:"",to:"",content:"configuration not found"};window.postMessage($)}catch(x){}return null}(),v=$?$.config.facebookConfig.videoDetectorConfigNew:null,C=$?$.id+"_w":null;const D="SCRIPT",V="XML_HTTP_REQUEST",p="INSTREAM_CONFIG",K="MARKETPLACE_VIDEO_AD",Z="FEED_VIDEO_AD",O=function(x,$,v="",C="",D="",V="",p="",K="",Z="",O=""){return{detectionTime:Date.now()/1e3|0,videoId:x,videoUrl:$,previewImageUrl:C,audioUrl:v,linkDisplay:D,userName:V,adName:p,adLogo:K,videoResolutionId:Z,audioResolutionId:O}},U=function(x,$){const v=new RegExp($,"i"),C=x.match(v),D=$.match(new RegExp("\\?<(?<groupName>.[^>]*)>"))?.groups.groupName;if(!C)return"";if(C.groups&&D)return 0===C.groups[D].search(/"/)?C.groups[D].replace(/"/,""):C.groups[D];let V=C.filter((x=>x));return!!V[1]&&V[1]},G=function(x,$){try{let v=$.replace(/}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const C=x.CHECKER;v=v.filter((x=>C.some(($=>new RegExp($).test(x)))));const D=[];if(v.length){for(let $ of v){let v=$;"string"==typeof $&&(v=JSON.parse($));const C=a(v,x),V=F(v,x),p=k(v,x),K=z(v,x.PATH_USER_NAME),Z=z(v,x.PATH_VIDEO_REPRESENTATION_ID,parseInt(p)),U=z(v,x.PATH_AUDIO_REPRESENTATION_ID,parseInt(p)),G=O(p,C,"",V,"",K,"","",Z,U);p&&C&&D.push(G)}D.forEach((x=>{setTimeout(m(x,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(x){}},w=function(x,$,v){let C=[];const D=[];try{C.push(JSON.parse($)),setTimeout(m({url:v,requestMethod:"POST",content:C},"FACEBOOK_INSTREAM_DATA"),0)}catch(V){C=$.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g),C.forEach(($=>{if($.length<=3||!x.CHECKER.some((x=>$.includes(x))))return;let v=JSON.parse($),C=v,V=v;for(let $ of x.PATH_NODES){const v=x.PATH_NODES.indexOf($),V=x.PATH_NODES.length-1;v!==V&&C[$]&&(C=C[$]),v===V&&C[$]&&(C=C[$],C.length?C.forEach(($=>{$.bisLinks={aboutPageLink:_($,x.PATH_USER_ID)},$.video_id=M($,x.PATH_VIDEO_ID),D.push($)})):(C.bisLinks={aboutPageLink:_(C,x.PATH_USER_ID)},C.video_id=M(C,x.PATH_VIDEO_ID),D.push(C)))}for(let $ of x.PATH_ALL_VIDEO){const v=x.PATH_ALL_VIDEO.indexOf($),C=x.PATH_ALL_VIDEO.length-1;if(v!==C&&V[$]&&(V=V[$]),"string"!=typeof $&&v===C&&$.length)if(V.length)V.forEach(((x,v)=>{const C=D[v];if(C.video_id===x.video_id)for(let v of $)if(x[v]){C[v]=x[v];break}}));else if(1===D.length){const x=D[0];if(x.video_id===V.video_id)for(let v of $)if(V[v]){x[v]=V[v];break}}}})),D.forEach((x=>{setTimeout(m({url:v,requestMethod:"POST",content:x},"FACEBOOK_INSTREAM_DATA"),0)}))}},M=function(x,$){let v=x,C=null;for(let x of $){const D=$.indexOf(x),V=$.length-1;D!==V&&v[x]&&(v=v[x]),D===V&&v[x]&&(C=v[x])}return parseInt(C,10)},_=function(x,$){let v=x,C=null;for(let x of $){const D=$.indexOf(x),V=$.length-1;D!==V&&v[x]&&(v=v[x]),D===V&&v[x]&&(C=`https://www.facebook.com/${v[x]}/about`)}return C},e=function(x,$){$=$.replace(/ /g,"");const C=U($,x.VIDEO_ID);if(!C)return;let D=null,V=null,p="",K="",Z="",G="",w="";x.VIDEO_HD_URL&&(D=U($,x.VIDEO_HD_URL)),x.VIDEO_SD_URL&&!D&&(V=U($,x.VIDEO_SD_URL)),x.LINK_DISPLAY&&(Z=U($,x.LINK_DISPLAY)),v.VIDEO_AUDIO_URL&&(p=U($,x.VIDEO_AUDIO_URL),p=p?p.split("\\").join(""):p),x.THUMBNAIL&&(K=U($,x.THUMBNAIL),K=K?K.split("\\").join(""):K),x.VIDEO_REPRESENTATION_ID&&(G=U($,x.VIDEO_REPRESENTATION_ID)),x.AUDIO_REPRESENTATION_ID&&(w=U($,x.AUDIO_REPRESENTATION_ID));let M=D||V;if(M){M=M.split("\\").join("");const x=O(C,M,p,K,Z,"","","",G,w);setTimeout(m(x,"FACEBOOK_VIDEO_DATA"),0)}},u=function(x,$){try{let v=$.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const C=x.CHECKER;v=v.filter((x=>C.some(($=>new RegExp($).test(x)))));const D=[];if(v.length){for(let $ of v){let v=$;"string"==typeof $&&(v=JSON.parse($));const C=b(v,x),V=a(v,x),p=F(v,x),K=k(v,x),Z=z(v,x.PATH_NAME),U=z(v,x.PATH_LOGO),G=z(v,x.PATH_VIDEO_REPRESENTATION_ID,parseInt(K)),w=z(v,x.PATH_AUDIO_REPRESENTATION_ID,parseInt(K)),M=O(K,V,C,p,"","",Z,U,G,w);K&&V&&D.push(M)}D.forEach((x=>{setTimeout(m(x,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(x){}},z=function(x,$,v=null){let C="";for(const D of $){const $=D.length;let V=x;for(let x=0;x<$;x++){const p=D[x],K=$-1;if("*"===p&&v){if([V]=V.filter((x=>v===parseInt(x.video_id))),!V)break}else if(p<0)V=V.slice(p,V.length)[0];else{if(!V[p])break;if(x===K){C=V[p];break}x!==K&&(V=V[p])}}}return C},b=function(x,$){let v="";for(const C of $.PATH_AUDIO_URL){const $=C.length;let D=x;for(let x=0;x<$;x++){const V=C[x],p=$-1;if(!D[V])break;x!==p&&D[V]&&(D=D[V]),x===p&&D[V]&&(v=D[V])}}return v},a=function(x,$){let v=null;for(const C of $.PATH_VIDEO_URL){const $=C.length;let D=x;for(let x=0;x<$;x++){const V=C[x],p=$-1;if(!D[V]&&V.includes&&!V.includes("%%%"))break;if(x!==p&&D[V]&&(D=D[V]),V.includes&&V.includes("%%%")){let[$,C]=V.split("%%%");if(D[$]||D[C]){if(x===p){v=D[$]?D[$]:D[C];break}D=D[$]?D[$]:D[C]}}x===p&&D[V]&&(v=D[V])}}return v},F=function(x,$){let v=null;for(const C of $.PATH_THUMBNAIL){const $=C.length;let D=x;for(let x=0;x<$;x++){const V=C[x],p=$-1;if(!D[V])break;x!==p&&D[V]&&(D=D[V]),x===p&&D[V]&&(v=D[V])}}return v},k=function(x,$){let v=null;for(const C of $.PATH_VIDEO_ID){const $=C.length;let D=x;for(let x=0;x<$;x++){const V=C[x],p=$-1;if(!D[V])break;x!==p&&D[V]&&(D=D[V]),x===p&&D[V]&&(v=D[V])}}return v},A=function(x,$,C=null){const D=function(x,$){$=String($);const C=v.PARSER_CONFIG[x];return C.SEPARATOR?$.split(C.SEPARATOR):[$]}($,x);D.forEach((x=>{setTimeout((()=>function(x,$=null,C=null){const D=$?v.PARSERS.filter((x=>x.TYPE===$)):v.PARSERS;for(const v of D)if(v.CHECKER.some(($=>x.includes($))))try{switch($){case p:setTimeout((()=>w(v,x,C)),0);break;case K:setTimeout((()=>u(v,x,C)),0);break;case Z:setTimeout((()=>G(v,x,C)),0);break;default:setTimeout((()=>e(v,x)),0)}}catch(x){}}(x,$,C)),0)}))},m=function($,v){return function(){!function($,v,C){let D;try{D={posdMessageId:"PANELOS_MESSAGE",posdHash:x(),type:C,from:$,to:$.substring(0,$.length-2),content:v},window.postMessage(D)}catch(x){}}(C,$,v)}};if(v?.PARSER_CONFIG.SCRIPT.USE){const x=function(){const x=document.querySelectorAll("script");for(const $ of x)$.hasAttribute("bis_use")||($.setAttribute("bis_use","true"),A($.innerHTML,D))};x(),setInterval(x,v.PARSER_CONFIG.SCRIPT.INTERVAL_MS||5e3)}if(v?.PARSER_CONFIG.LISTEN_HTTP_REQUESTS){let x=XMLHttpRequest.prototype.open,$=XMLHttpRequest.prototype.setRequestHeader,C=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.setRequestHeader=function(){const x=arguments[0].toLowerCase(),v=arguments[1];this.requestHeaders||(this.requestHeaders={}),this.requestHeaders[x]=v,$.apply(this,arguments)},XMLHttpRequest.prototype.open=function(){this.requestMethod=arguments[0],x.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){let x=this.onreadystatechange;return this.onreadystatechange=function(){const $=v.MATCH_URLS,C=v.MATCH_HEADERS,D=this.requestHeaders?Object.keys(this.requestHeaders):null,O=v.PARSER_CONFIG.INSTREAM_CONFIG,U=v.PARSER_CONFIG.MARKETPLACE_VIDEO_AD,G=v.PARSER_CONFIG.FEED_VIDEO_AD;let w=!1,M=null,_=null;if(D&&(w=D.some((x=>{if(C[x]&&C[x].includes(this.requestHeaders[x]))return M=x,_=this.requestHeaders[x],!0}))),4===this.readyState&&$.filter((x=>x.indexOf(this.responseURL))).length>0)if(w)switch(!0){case O.USE&&O.HEADERS[M].includes(_):setTimeout((()=>A(this.response,p,this.responseURL)),0);break;case U.USE&&U.HEADERS[M].includes(_):setTimeout((()=>A(this.response,K,this.responseURL)),0);break;case G.USE&&G.HEADERS[M].includes(_):setTimeout((()=>A(this.response,Z,this.responseURL)),0)}else setTimeout((()=>A(this.response,V)),0);if(x)return x.apply(this,arguments)},C.apply(this,arguments)}}}x(),window.addEventListener("message",($=>{switch($.data?.type){case"CONFIG_UPDATED_IN_STORAGE":return void x();case"FACEBOOK_CANVAS_TEXT":let v=Array.from(document.querySelectorAll(bis_data.config.facebookConfig.QUERY_GET_SPONSORED_CANVAS)),C=null,D=$.data.content.attribute;const V=bis_data.config.facebookConfig.PATH_TO_CANVAS_TEXT;for(let x of v){if(!Object.entries(x).some((x=>{if(x[0].search(/reactFiber/)>=0)return C=x[0],!0})))return void x.setAttribute(D,"");let $=x[C];for(let x of V)$[x]&&($=$[x]);x.setAttribute(D,$)}}}))})();