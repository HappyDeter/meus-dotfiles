if(1!==self["apply.js"]){self["apply.js"]=1;const e=this,t=e.document;(()=>{const n={get:({name:e},t)=>new Proxy(Object.defineProperty(()=>{},"name",{value:e?e+"."+t:t}),n),apply:async function({name:e},t,n){const o=new Error,i={data:{method:"invokeAPI",path:e,args:n},TDM:s};for(let e,t,n=0;n<2;n++){try{if(e=await chrome.runtime.sendMessage(i),e){if(c=r=null,t=e.error)throw t.stack+="\n"+o.stack,t;return e.data}}catch(e){if(!c)throw e.stack=o.stack,e}if(n)throw new Error("Stylus could not connect to the background script.");await c}}},o=e.API=new Proxy({path:""},n),i=window!==top;let r,c=!1,s=i?0:t.prerendering?-1:1;function a(e){s=e}const f=new Map,l=e=>({data:e}),d=e=>({error:Object.assign({message:e.message||`${e}`,stack:e.stack},e)});function u(e,t,n){let o,i,r=0;n&&(n=e.length>1&&e,e=e[0]);do{for(const[r,c]of f){try{i=r(e,t,!!n)}catch(e){i=Promise.reject(e)}c&&i!==o&&void 0===o&&(o=i)}}while(n&&(e=n[++r]));return o}chrome.runtime.onMessage.addListener(function({data:e,multi:t,TDM:n},o,i){0;0;o.TDM=n;let r=!1;if(r=r?r.then(u.bind(null,e,o,t)):u(e,o,t),r instanceof Promise)return r.then(l,d).then(i),!0;void 0!==r&&i(l(r))});const g=!1,m="stylus",p=m+"-",h="screen, "+p,w="adoptedStyleSheets",y={cfg:{off:!1,top:""}},b=chrome.runtime,v=b.id,k=t instanceof XMLDocument,S=t,E=new Set(["head","body","frameset","style","link"]),L=function(e){let n,o=!1;const i=new MutationObserver(e);return{start:function(){if(o||P)return;z=t.documentElement,n=setTimeout(e),i.observe(t,{childList:!0}),o=!0},stop:function(){if(!o)return;clearTimeout(n),i.disconnect(),o=!1}}}(pe),M=function(e){let t=!1;const n=new MutationObserver(e);return{start:o,stop:i,restart:function(){t&&(i(),o())}};function o(){t||P||(n.observe(z,{childList:!0}),t=!0)}function i(){t&&(n.disconnect(),t=!1)}}(ue),x=e=>String.fromCharCode(65280+e.charCodeAt(0)-32),O=[],j={},T=({id:e})=>1e6*J[e]||q[e]||e+5e5,A=(e,t)=>T(e)-T(t),U=new Map;let P,C,D,$,R,I,N,B,G,J,q,V,X,z=t.documentElement,F=!0,H="",K=0,Q=0;function W(e){de(U.get(e))&&ae()}function Y(e){F!==(e=!!e)&&(F=e,e?_():te())}function Z(e,t){if(P){const n=C||S[w].slice();let o=D(n,e);o>=0&&(e=n.splice(o,1)[0]),o=t?D(n,t):-1,o>=0?n.splice(o,0,e):n.push(e),C||(S[w]=n)}else pe().insertBefore(e,t);return e}function _(){O.length&&(se(!1),P?ne(!0):pe().append(...O.map(e=>e.el)),se(!0))}function ee(e){if(e.remove)e.remove();else if(P){const t=C||S[w].slice(),n=D(t,e);n>=0&&(t.splice(n,1),C||(S[w]=t))}}function te(){if(se(!1),P)ne();else for(const{el:e}of O)ee(e)}function ne(e){const t=O.map(e=>e.el),n=[];for(let e,o=C||S[w],i=0;i<o.length&&(e=o[i]);i++)D(t,e)<0&&n.push(e);e&&n.push(...t),S[w]=n}function oe({cfg:e,sections:t},n){e&&me(e);const o=n&&new Set;for(const e of t){const{id:t,code:i}=e,r=Array.isArray(i)?e.code=i.join(""):i,c=U.get(t);if(c)(c.code!==r||R&&c.name!==e.name)&&(c.code=r,ce(c.el,e),c.el.disabled=!1);else{e.el=re(e),U.set(t,e);const n=O.findIndex(t=>T(t)>T(e));O.splice(n<0?O.length:n,0,e)}n&&o.add(t)}if(se(!1),n&&O.length>o.size)for(let e,t=O.length;--t>=0;)o.has((e=O[t]).id)||de(e);F&&($||ie(t),ue()),ae()}function ie(e){if($=!0,"complete"===t.readyState||"hidden"===t.visibilityState||!e.some(e=>e.code.includes("transition")))return;const n=re({id:"transition-patch",code:":not(#\\0):not(#\\0) { transition: none !important }"});Z(n),requestAnimationFrame(()=>setTimeout(ee,0,n))}function re(e){let t,{id:n}=e;if(P){R||(n=j[n]??=Math.random().toString(36).slice(2)),n=h+n,t=new CSSStyleSheet({media:n}),ce(t,e);for(let e,t=C||S[w],o=0;o<t.length;o++)(e=t[o].media).mediaText===n&&(e.mediaText+="-old");return t}return!N&&(t=le(e))||(t=z instanceof SVGSVGElement?G("http://www.w3.org/2000/svg","style"):k?G("http://www.w3.org/1999/xhtml","style"):B("style"),H&&(t.nonce=H),n&&R&&(n=t.id=`${p}${n}`),t.classList.add(m),ce(t,e)),t}function ce(e,{id:t,code:n,name:o}){if(P)try{e.replaceSync(n)}catch{e.replace(n)}else R&&o&&(e.dataset.name!==o&&(e.dataset.name=o),o=encodeURIComponent(o.replace(/[?#/']/g,x)),n+=`\n/*# sourceURL=${b.getURL(o)}.user.css#${t}${window!==top?"#"+Math.random().toString(36).slice(2):""} */`),(e.firstChild||e).textContent=n}function se(e){if(P&&e)return;const t=e&&F?"start":"stop";L[t](),M[t]()}function ae(){se(O.length),V()}function fe(){D||(Object.isExtensible(P)&&(C=P),D=Object.call.bind([].indexOf))}function le(e){N=S;for(let e,t=0;!e&&t<2;t++)return B=N.createElement.bind(N),void(G=N.createElementNS.bind(N))}function de(e){if(e)return U.delete(e.id),O.splice(O.indexOf(e),1),ee(e.el),!0}function ue(e){if(!b.id)return X();let t,n=O.length&&O[0].el;if(n)if(P){C||(P=S[w]);for(let e=O.length,n=P.length-e,o=0;o<e;o++)if(n<0||P[n+o]!==O[o].el){t=!0;break}}else if(n.parentNode!==N.documentElement)t=!0;else{let e=0;for(;n;){if(e<O.length&&n===O[e].el)e++;else if(E.has(n.localName)){t=!0;break}n=n.nextElementSibling}e<O.length&&(t=!0)}else t=!1;if(!t)return;!e||++K<10?_():console.debug("Stylus ignored wrong order of styles to avoid an infinite loop of mutations.");const o=performance.now();o-Q>250&&(K=0,Q=o)}function ge(){O.sort(A),F&&_()}function me(e){if(R=e.name,H=e.nonce||H,I=!H&&g,({main:q={},prio:J={}}=e.order||{}),!P!=!e.ass){te(),P=P?null:S[w],P&&fe();for(const e of O)e.el=re(e);_()}}function pe(){return b.id?(z!==t.documentElement&&(z=t.documentElement,_(),M.restart()),z):X()}const he="styles",we="pageshow",ye=e=>"object"==typeof e&&e?JSON.parse(JSON.stringify(e)):e;let be=!1;if(i)try{be=Object.getOwnPropertyDescriptor(parent.location,"href"),be=!!be?.get}catch{}const ve=be&&"about:"===location.protocol,ke=`${Math.random()}`,Se="url:"+b.id,Ee=e[Se]=new EventTarget,Le=ve&&parent[Se]||null;let Me,xe,Oe,je,Te,Ae,Ue=ve?parent.location.href.split("#")[0]:location.href,Pe=i;async function Ce(){let e;if(e=ve&&ye(parent[parent.Symbol.for(he)]),e?await new Promise(ze):e=!be&&!k&&Re(),!b.id)return Ye();await De(e,!0)}async function De(t,n=!y.sections){t||(t=await $e({init:n})),t.cfg||(t.cfg=y.cfg),Object.assign(y,e[Symbol.for(he)]=t),i||""!==y.cfg.topUrl||(y.cfg.topUrl=location.origin),O.length?oe(y,!0):y.cfg.off||oe(y),Y(!y.cfg.off)}function $e(e){return i||(e.dark=(Me??(Me=matchMedia("(prefers-color-scheme: dark)"),be||(Me.onchange=({matches:e})=>{e!==y.cfg.dark&&o.setSystemDark(y.cfg.dark=e)}),Me)).matches),o.styles.getSectionsByUrl(Ue,e)}function Re(){try{const e=(t.cookie.split(v+"=")[1]||"").split(";")[0];if(!e)return;const n="blob:"+b.getURL(e);t.cookie=`${v}=1; max-age=0; SameSite=Lax`;const o=new XMLHttpRequest;return o.open("GET",n,!1),o.send(),JSON.parse(o.response)}catch{}}function Ie(e,t,n){if(n)return je??=Promise.resolve().then(Ne)&&[],void je.push(e);const{style:o}=e;switch(e.method){case"ping":return!0;case"styleDeleted":W(o.id);break;case"styleUpdated":if(!y.sections&&y.cfg.off)break;o.enabled?$e({id:o.id}).then(e=>e.sections.length?oe(e):W(o.id)):W(o.id);break;case"styleAdded":!y.sections&&y.cfg.off||!o.enabled||$e({id:o.id}).then(oe);break;case"urlChanged":0===e.iid&&Xe(e.url);break;case"injectorConfig":Be(e);break;case"backgroundReady":return y.sections&&qe(),!0}}function Ne(){for(const e of je)Ie(e);je=null,qe()}function Be({cfg:e}){for(const t in e){const n=e[t];n!==y.cfg[t]&&((i||"top"!==t&&"topUrl"!==t)&&(y.cfg[t]=n,"off"===t?Ge():"order"===t?ge():"top"===t?Je():"wake"===t?Ve():me(y.cfg)))}}function Ge(){y.sections||y.cfg.off?Y(!y.cfg.off):xe||Ce()}function Je(){const e="stylus-iframe",n=t.documentElement;n&&(y.cfg.top&&O.length?n.getAttribute(e)!==y.cfg.topUrl&&n.setAttribute(e,y.cfg.topUrl):n.hasAttribute(e)&&n.removeAttribute(e))}function qe(){let e,t;s<0||(i&&Pe&&performance.now()>1e3&&(Pe=!1),je||Te===(t=(e=[...U.keys()]).join(","))||(o.updateIconBadge(e,Pe,0),Te=t))}function Ve(){y.cfg.wake||O.length?Oe||!i&&!y.cfg.wake||(Oe=b.connect({name:"apply"}),Oe.onDisconnect.addListener(Ke)):(Oe?.disconnect(),Oe=null)}function Xe(e){e!==Ue&&(Ue=e,y.sections&&De(y.cfg.off&&{}),Ee.dispatchEvent(new Event(Se)))}function ze(e){parent[parent.Symbol.for("xo")](frameElement,e),(xe??=[]).push(e)}function Fe(e){if(!b.id)return Ye();for(const t of e)t.intersectionRatio&&(Ae.unobserve(t.target),t.target.dispatchEvent(new Event(ke)))}function He(e){if(!b.id)return Ye();e.isTrusted&&e.persisted&&(Te="",Ce())}function Ke(){y.cfg.wake&&addEventListener("mousedown",Qe,!0),Oe=null}function Qe(e){if(!b.id)return Ye();!Oe&&e.target.closest("a")?.href&&Ve()}function We(){Xe(parent.location.href)}function Ye(){if(removeEventListener(we,He),Me&&(Me=Me.onchange=null),xe)for(const e of xe)e();s<0&&(t.onprerenderingchange=null),removeEventListener("mousedown",Qe,!0),Le?.removeEventListener(Se,We,!0),xe=null,O.length&&(se(!1),te(),O.length=0,U.clear()),f.delete(Ie),Oe?.disconnect()}e[Symbol.for("xo")]=(e,t)=>{Ae||(Ae=new IntersectionObserver(Fe,{rootMargin:"100%"})),e.addEventListener(ke,t,{once:!0}),Ae.observe(e)},Le?.addEventListener(Se,We,!0),s<0&&(t.onprerenderingchange=function(e){if(!b.id)return Ye();e.isTrusted&&(a(2),t.onprerenderingchange=null,$e({init:"cfg"}).then(Be),qe())}),V=()=>{qe(),i&&Je(),(i||y.cfg.wake)&&Ve()},X=Ye,Ce(),f.set(Ie,!0),addEventListener(we,He)})()}